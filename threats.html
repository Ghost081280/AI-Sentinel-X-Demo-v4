<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThreatScanner | AI Sentinel-X</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00ff88;
            --secondary: #00ccff;
            --accent: #7c3aed;
            --danger: #ff0044;
            --warning: #ffaa00;
            --success: #00ff88;
            --bg-dark: #0a0e1a;
            --bg-darker: #060912;
            --bg-card: rgba(10, 20, 40, 0.8);
            --border: rgba(0, 255, 136, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #8892b0;
            --gradient-1: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
            --gradient-2: linear-gradient(135deg, #7c3aed 0%, #00ccff 100%);
            --gradient-shield: linear-gradient(135deg, #1a4d2e 0%, #00ff88 50%, #00ccff 100%);
            --gradient-danger: linear-gradient(135deg, #ff0044 0%, #ff6644 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Consolas', 'Monaco', monospace;
            background: var(--bg-darker);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Neural Network Background Canvas */
        #neuralCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.3;
        }

        /* Container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px 35px;
            margin-bottom: 30px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        /* Logo */
        .logo-container {
            width: 80px;
            height: 80px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-shield {
            width: 50px;
            height: 50px;
            background: var(--gradient-shield);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            position: relative;
            animation: shieldPulse 3s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes shieldPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .logo-eye {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--bg-darker);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-iris {
            width: 20px;
            height: 20px;
            background: var(--gradient-1);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
        }

        .rotating-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 6px var(--primary);
        }

        .dot:nth-child(1) { top: 0; left: 50%; transform: translateX(-50%); }
        .dot:nth-child(2) { top: 50%; right: 0; transform: translateY(-50%); }
        .dot:nth-child(3) { bottom: 0; left: 50%; transform: translateX(-50%); }

        .brand-info {
            display: flex;
            flex-direction: column;
        }

        .brand-name {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 2px;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-tagline {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        /* Encryption Status Badge - Matching dashboard style */
        .encryption-badges {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .encryption-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--primary);
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .encryption-badge:hover {
            background: rgba(0, 255, 136, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        .status-light {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
            animation: statusPulse 3s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        .agent-status {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--primary);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .agent-status:hover {
            background: rgba(0, 255, 136, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        .agent-icon {
            font-size: 20px;
        }

        .agent-info {
            display: flex;
            flex-direction: column;
        }

        .agent-title {
            font-weight: bold;
            font-size: 14px;
            color: var(--primary);
        }

        .agent-status-text {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .logout-btn {
            background: transparent;
            border: 1px solid rgba(255, 0, 68, 0.3);
            border-radius: 8px;
            padding: 10px 20px;
            color: var(--danger);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .logout-btn:hover {
            background: rgba(255, 0, 68, 0.1);
            transform: translateY(-2px);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            background: var(--bg-card);
            padding: 12px;
            border-radius: 15px;
            border: 1px solid var(--border);
            overflow-x: auto;
            backdrop-filter: blur(15px);
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .nav-tab:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--border);
            color: var(--primary);
        }

        .nav-tab.active {
            background: var(--gradient-1);
            color: var(--bg-darker);
            font-weight: bold;
        }

        /* Sub-Agent Status Banner - FIXED STANDARDIZED 90px HEIGHT */
        .sub-agent-status {
            background: linear-gradient(135deg, rgba(255, 0, 68, 0.1) 0%, rgba(255, 68, 68, 0.05) 100%);
            border: 1px solid rgba(255, 0, 68, 0.3);
            border-radius: 12px;
            padding: 20px 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
            min-height: 90px;
            max-height: 90px;
        }

        .sub-agent-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 0, 68, 0.1), transparent);
            animation: bannerScan 8s linear infinite;
        }

        @keyframes bannerScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .sub-agent-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sub-agent-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-danger);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(255, 0, 68, 0.3);
        }

        .sub-agent-details h3 {
            font-size: 18px;
            color: var(--danger);
            margin-bottom: 5px;
        }

        .sub-agent-details p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .sub-agent-metrics {
            display: flex;
            gap: 30px;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--danger);
            text-shadow: 0 0 10px currentColor;
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* Main Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
            align-items: stretch;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* Section Cards */
        .section-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
        }

        /* FIXED: Make the right column cards fill available height properly - CORRECTED HEIGHT */
        .right-column .section-card,
        .right-column .intelligence-section {
            height: 590px !important;
            min-height: 590px !important;
            max-height: 590px !important;
            flex: none !important;
        }

        /* Override any shared.js interference */
        .threats-page .right-column .section-card,
        .threats-page .right-column .intelligence-section {
            height: 590px !important;
            min-height: 590px !important;
            max-height: 590px !important;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-status {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-dot.active {
            background: var(--success);
        }

        .status-dot.warning {
            background: var(--warning);
        }

        .status-dot.danger {
            background: var(--danger);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.5); }
        }

        /* Active Threats Grid */
        .threats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .threat-card {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(255, 0, 68, 0.02) 100%);
            border: 1px solid rgba(255, 0, 68, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .threat-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--danger), var(--warning), var(--accent));
            border-radius: 12px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .threat-card:hover::before {
            opacity: 0.3;
        }

        .threat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(255, 0, 68, 0.3);
            border-color: var(--danger);
        }

        .threat-card.critical {
            border-color: var(--danger);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(255, 0, 68, 0.05) 100%);
        }

        .threat-card.high {
            border-color: var(--warning);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(255, 170, 0, 0.05) 100%);
        }

        .threat-card.medium {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 204, 255, 0.05) 100%);
        }

        .threat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .threat-title {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 16px;
            flex: 1;
        }

        .threat-type {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .threat-severity {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .threat-severity.critical {
            background: rgba(255, 0, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .threat-severity.high {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .threat-severity.medium {
            background: rgba(0, 204, 255, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .threat-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .threat-detail {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .threat-detail-label {
            color: var(--text-secondary);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .threat-detail-value {
            color: var(--text-primary);
            font-weight: bold;
            text-align: right;
        }

        .threat-ai-status {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
        }

        .ai-analysis {
            color: var(--accent);
            font-style: italic;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .sub-agent-coord {
            color: var(--text-secondary);
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* FIXED: Threat Classification & Analysis - Full Height with Scrollable */
        .threat-analysis-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            min-height: 0;
        }

        .threat-analysis-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .threat-analysis-item {
            padding: 18px;
            border-radius: 12px;
            border-left: 4px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 85px;
            gap: 15px;
        }

        .threat-analysis-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: left 0.5s ease;
        }

        .threat-analysis-item:hover::before {
            left: 100%;
        }

        .threat-analysis-item:hover {
            transform: translateY(-2px);
        }

        .threat-analysis-item.critical {
            background: rgba(255, 0, 68, 0.1);
            border-left-color: var(--danger);
        }

        .threat-analysis-item.high {
            background: rgba(255, 170, 0, 0.1);
            border-left-color: var(--warning);
        }

        .threat-analysis-item.medium {
            background: rgba(0, 204, 255, 0.1);
            border-left-color: var(--secondary);
        }

        .threat-analysis-item.low {
            background: rgba(0, 255, 136, 0.1);
            border-left-color: var(--success);
        }

        .threat-analysis-content-inner {
            flex: 1;
            min-width: 0;
        }

        .threat-analysis-title {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 6px;
            line-height: 1.2;
        }

        .threat-analysis-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            font-size: 10px;
            margin-bottom: 4px;
        }

        .threat-analysis-label {
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .threat-analysis-value {
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .threat-analysis-description {
            grid-column: 1 / -1;
            font-size: 9px;
            color: var(--text-secondary);
            line-height: 1.3;
            margin-top: 2px;
        }

        .threat-analysis-score {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            min-width: 45px;
            flex-shrink: 0;
        }

        .threat-analysis-score.critical {
            background: rgba(255, 0, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .threat-analysis-score.high {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .threat-analysis-score.medium {
            background: rgba(0, 204, 255, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .threat-analysis-score.low {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        /* Threat Intelligence & Correlation - Balanced height with scrollable content */
        .intelligence-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .intelligence-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            min-height: 0;
        }

        .intelligence-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .intelligence-card {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.05) 0%, rgba(0, 204, 255, 0.02) 100%);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 160px;
            display: flex;
            flex-direction: column;
        }

        .intelligence-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(124, 58, 237, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .intelligence-card:hover::before {
            left: 100%;
        }

        .intelligence-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(124, 58, 237, 0.2);
            border-color: var(--accent);
        }

        .intelligence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .intelligence-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .intelligence-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            background: rgba(124, 58, 237, 0.2);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .intelligence-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .intelligence-metric {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .intelligence-metric-value {
            font-size: 16px;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 3px;
        }

        .intelligence-metric-label {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .intelligence-coordination {
            padding: 12px;
            background: rgba(124, 58, 237, 0.05);
            border: 1px solid rgba(124, 58, 237, 0.2);
            border-radius: 8px;
            margin-top: auto;
        }

        .coordination-title {
            font-size: 11px;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .coordination-agents {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .coordination-agent {
            padding: 3px 8px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            font-size: 9px;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* FIXED: Threat Hunting & Investigation - Full Height with Scrollable content */
        .threat-hunting-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            min-height: 0;
        }

        .threat-hunting-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .threat-hunting-card {
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.05) 0%, rgba(255, 68, 68, 0.02) 100%);
            border: 1px solid rgba(255, 170, 0, 0.3);
            border-radius: 12px;
            padding: 22px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 220px;
        }

        .threat-hunting-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 170, 0, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .threat-hunting-card:hover::before {
            left: 100%;
        }

        .threat-hunting-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(255, 170, 0, 0.2);
            border-color: var(--warning);
        }

        .threat-hunting-card.active {
            background: linear-gradient(135deg, rgba(255, 0, 68, 0.05) 0%, rgba(255, 170, 0, 0.02) 100%);
            border-color: var(--danger);
        }

        .threat-hunting-card.investigating {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.05) 0%, rgba(255, 170, 0, 0.02) 100%);
            border-color: var(--accent);
        }

        .hunting-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .hunting-title {
            font-weight: bold;
            color: var(--warning);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hunting-priority {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hunting-priority.critical {
            background: rgba(255, 0, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .hunting-priority.high {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .hunting-priority.medium {
            background: rgba(0, 204, 255, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .hunting-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .hunting-iocs {
            margin-bottom: 15px;
        }

        .hunting-iocs-title {
            font-size: 11px;
            font-weight: bold;
            color: var(--warning);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hunting-iocs-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .hunting-ioc {
            padding: 3px 8px;
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid rgba(255, 170, 0, 0.3);
            border-radius: 8px;
            font-size: 10px;
            color: var(--warning);
            font-family: 'Courier New', monospace;
        }

        .hunting-progress {
            margin-bottom: 15px;
        }

        .hunting-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .hunting-progress-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hunting-progress-percent {
            font-size: 11px;
            color: var(--warning);
            font-weight: bold;
        }

        .hunting-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .hunting-progress-fill {
            height: 100%;
            background: var(--gradient-1);
            border-radius: 3px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
        }

        .hunting-agents {
            padding: 12px;
            background: rgba(255, 170, 0, 0.05);
            border: 1px solid rgba(255, 170, 0, 0.2);
            border-radius: 8px;
        }

        .hunting-agents-title {
            font-size: 11px;
            font-weight: bold;
            color: var(--warning);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hunting-agents-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .hunting-agent {
            padding: 3px 8px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            font-size: 9px;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Threat Response Automation */
        .response-automation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .response-automation-card {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.05) 0%, rgba(0, 204, 255, 0.02) 100%);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .response-automation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .response-automation-card:hover::before {
            left: 100%;
        }

        .response-automation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 255, 136, 0.2);
            border-color: var(--primary);
        }

        .response-automation-card.executing {
            background: linear-gradient(135deg, rgba(0, 204, 255, 0.1) 0%, rgba(124, 58, 237, 0.05) 100%);
            border-color: var(--secondary);
        }

        .automation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .automation-title {
            font-weight: bold;
            color: var(--primary);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .automation-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .automation-status.active {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .automation-status.executing {
            background: rgba(0, 204, 255, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .automation-status.standby {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .automation-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .automation-metric {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .automation-metric-value {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 3px;
        }

        .automation-metric-label {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .automation-coordination {
            padding: 12px;
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            margin-top: 12px;
        }

        .automation-coordination-title {
            font-size: 11px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .automation-chain {
            font-size: 10px;
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
            line-height: 1.3;
        }

        .automation-progress {
            margin-top: 12px;
            display: none;
        }

        .automation-progress.active {
            display: block;
        }

        .automation-progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .automation-progress-fill {
            height: 100%;
            background: var(--gradient-1);
            border-radius: 2px;
            transition: width 0.3s ease;
            box-shadow: 0 0 8px rgba(0, 255, 136, 0.5);
        }

        .automation-progress-text {
            font-size: 9px;
            color: var(--secondary);
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Activity Feed using shared.js infrastructure */
        .activity-feed {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            height: 500px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            margin-top: 25px;
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .feed-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--danger);
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: livePulse 2s ease-in-out infinite;
        }

        @keyframes livePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
        }

        .feed-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .feed-item {
            background: rgba(255, 0, 68, 0.05);
            border-left: 3px solid var(--danger);
            padding: 15px 20px;
            margin-bottom: 12px;
            border-radius: 0 10px 10px 0;
            transition: all 0.3s ease;
            animation: feedSlide 0.3s ease;
        }

        @keyframes feedSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .feed-item:hover {
            background: rgba(255, 0, 68, 0.1);
            transform: translateX(5px);
        }

        .feed-item.warning {
            background: rgba(255, 170, 0, 0.05);
            border-left-color: var(--warning);
        }

        .feed-item.danger {
            background: rgba(255, 0, 68, 0.05);
            border-left-color: var(--danger);
        }

        .feed-item.encryption {
            background: rgba(124, 58, 237, 0.05);
            border-left-color: var(--accent);
        }

        .feed-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .feed-message {
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 5px;
        }

        .feed-agent {
            font-size: 11px;
            color: var(--accent);
            font-style: italic;
        }

        /* AI Chat Widget */
        .ai-chat-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .ai-chat-toggle {
            width: 60px;
            height: 60px;
            background: var(--gradient-1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
            transition: all 0.3s ease;
            font-size: 28px;
            border: none;
            color: var(--bg-darker);
        }

        .ai-chat-toggle:hover {
            transform: scale(1.1);
        }

        .ai-chat-window {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 400px;
            height: 500px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            display: none;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }

        .ai-chat-window.active {
            display: flex;
            animation: chatSlideIn 0.3s ease;
        }

        @keyframes chatSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-chat-header {
            background: var(--gradient-1);
            color: var(--bg-darker);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .ai-chat-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .chat-status-dot {
            width: 8px;
            height: 8px;
            background: var(--bg-darker);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .ai-chat-close {
            cursor: pointer;
            font-size: 24px;
            background: none;
            border: none;
            color: var(--bg-darker);
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            display: flex;
            flex-direction: column;
        }

        .ai-message-bubble {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 15px 20px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .ai-message-bubble.user {
            background: rgba(0, 204, 255, 0.1);
            border-color: var(--secondary);
            align-self: flex-end;
        }

        .ai-message-bubble.system {
            background: rgba(124, 58, 237, 0.1);
            border-color: var(--accent);
            font-size: 13px;
            font-style: italic;
        }

        .ai-message-bubble.error {
            background: rgba(255, 0, 68, 0.1);
            border-color: var(--danger);
        }

        .ai-message-bubble code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .ai-message-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .ai-chat-input-container {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-shrink: 0;
        }

        .ai-chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 15px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .ai-chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .ai-chat-input::placeholder {
            color: var(--text-secondary);
        }

        .ai-chat-send {
            background: var(--gradient-1);
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: var(--bg-darker);
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        /* CLI Mode Indicator */
        .cli-mode-indicator {
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 12px;
            color: var(--warning);
            display: none;
            flex-shrink: 0;
        }

        .cli-mode-indicator.active {
            display: block;
        }

        /* Agent Shutdown Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--warning);
            margin-bottom: 10px;
        }

        .modal-content {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-btn-primary {
            background: var(--gradient-1);
            color: var(--bg-darker);
        }

        .modal-btn-secondary {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-secondary);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        /* Mobile Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .threats-grid {
                grid-template-columns: 1fr;
            }

            .intelligence-grid {
                grid-template-columns: 1fr;
            }

            .threat-hunting-grid {
                grid-template-columns: 1fr;
            }

            .response-automation-grid {
                grid-template-columns: 1fr;
            }

            .right-column .section-card {
                height: auto !important;
                min-height: 300px !important;
                max-height: none !important;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }
            
            .encryption-badges {
                order: -1;
                justify-content: center;
            }
            
            .nav-tabs {
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }
            
            .sub-agent-status {
                flex-direction: column;
                text-align: center;
                min-height: auto !important;
                max-height: none !important;
            }
            
            .sub-agent-metrics {
                flex-direction: column;
                gap: 15px;
            }
            
            .ai-chat-window {
                width: calc(100vw - 40px);
                height: calc(100vh - 140px);
                right: -20px;
                bottom: 80px;
            }

            .threat-details {
                grid-template-columns: 1fr;
            }

            .intelligence-metrics {
                grid-template-columns: 1fr;
            }

            .automation-metrics {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--danger);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--warning);
        }
    </style>
</head>
    <body class="threats-page">
    <script>
        // Check authentication
        const auth = localStorage.getItem('sentinel_auth');
        if (!auth) {
            window.location.href = 'index.html';
        } else {
            const authData = JSON.parse(auth);
            if (Date.now() - authData.timestamp > 24 * 60 * 60 * 1000) {
                localStorage.removeItem('sentinel_auth');
                window.location.href = 'index.html';
            }
        }
    </script>

    <!-- Neural Network Background -->
    <canvas id="neuralCanvas"></canvas>

    <!-- Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-container">
                        <div class="rotating-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <div class="logo-shield">
                            <div class="logo-eye">
                                <div class="logo-iris"></div>
                            </div>
                        </div>
                    </div>
                    <div class="brand-info">
                        <h1 class="brand-name">AI SENTINEL-X</h1>
                        <p class="brand-tagline">Autonomous Cyber Defense</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="encryption-badges">
                        <div class="encryption-badge" onclick="showEncryptionStatus('hybrid')">
                            <div class="status-light"></div>
                            <span>HYBRID MODE ACTIVE</span>
                        </div>
                    </div>
                    <div class="agent-status" onclick="showAgentShutdownModal()">
                        <span class="agent-icon">🤖</span>
                        <div class="agent-info">
                            <span class="agent-title">AI Agent Active</span>
                            <span class="agent-status-text" id="agentModeText">Autonomous with Manual Override</span>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="handleLogout()">Logout</button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <a href="dashboard.html" class="nav-tab">
                <span>🏠</span>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-tab active">
                <span>🛡️</span>
                <span>Threats</span>
            </a>
            <a href="network.html" class="nav-tab">
                <span>🌐</span>
                <span>Network</span>
            </a>
            <a href="defense.html" class="nav-tab">
                <span>⚔️</span>
                <span>Defense</span>
            </a>
            <a href="ai-engine.html" class="nav-tab">
                <span>🧠</span>
                <span>AI Engine</span>
            </a>
            <a href="encryption.html" class="nav-tab">
                <span>🔐</span>
                <span>Encryption</span>
            </a>
            <a href="analytics.html" class="nav-tab">
                <span>📊</span>
                <span>Analytics</span>
            </a>
            <a href="vpn.html" class="nav-tab">
                <span>🔒</span>
                <span>VPNMonitor</span>
            </a>
            <a href="settings.html" class="nav-tab">
                <span>⚙️</span>
                <span>Settings</span>
            </a>
        </nav>

        <!-- FIXED: Sub-Agent Status Banner - STANDARDIZED with proper metric layout -->
        <div class="sub-agent-status">
            <div class="sub-agent-info">
                <div class="sub-agent-icon">🛡️</div>
                <div class="sub-agent-details">
                    <h3>ThreatScanner Sub-Agent</h3>
                    <p>Enhanced V4 threat detection • AI correlation engine • Sub-agent coordination • Reports to Main Agent</p>
                </div>
            </div>
            <div class="sub-agent-metrics">
                <div class="metric" onclick="showMetricDetails('threats')">
                    <div class="metric-value" id="activeThreats">8</div>
                    <div class="metric-label">Active Threats</div>
                </div>
                <div class="metric" onclick="showMetricDetails('blocked')">
                    <div class="metric-value" id="blockedToday">3,247</div>
                    <div class="metric-label">Blocked Today</div>
                </div>
                <div class="metric" onclick="showMetricDetails('detection')">
                    <div class="metric-value">99.8%</div>
                    <div class="metric-label">Detection Rate</div>
                </div>
                <div class="metric" onclick="showMetricDetails('correlated')">
                    <div class="metric-value" id="correlatedThreats">16</div>
                    <div class="metric-label">Correlated</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Active Threats -->
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>🎯</span>
                            <span>Active Threats</span>
                        </h2>
                        <div class="section-status">
                            <div class="status-dot danger"></div>
                            <span id="threatStatus">8 Critical Threats</span>
                        </div>
                    </div>
                    <div class="threats-grid" id="threatsGrid">
                        <!-- Threats will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Threat Intelligence & Correlation -->
                <div class="section-card intelligence-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>🧠</span>
                            <span>Threat Intelligence & Correlation</span>
                        </h2>
                        <div class="section-status">
                            <div class="status-dot active"></div>
                            <span>AI Enhanced</span>
                        </div>
                    </div>
                    <div class="intelligence-content">
                        <div class="intelligence-grid" id="intelligenceGrid">
                            <!-- Intelligence cards will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="right-column">
                <!-- Threat Classification & Analysis -->
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>🎯</span>
                            <span>Threat Classification & Analysis</span>
                        </h2>
                        <div class="section-status">
                            <div class="status-dot danger"></div>
                            <span id="threatAnalysisStatus">Live Analysis</span>
                        </div>
                    </div>
                    <div class="threat-analysis-content">
                        <div class="threat-analysis-list" id="threatAnalysisList">
                            <!-- Threat analysis will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Threat Hunting & Investigation -->
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>🔍</span>
                            <span>Threat Hunting & Investigation</span>
                        </h2>
                        <div class="section-status">
                            <div class="status-dot active"></div>
                            <span>4 Active Hunts</span>
                        </div>
                    </div>
                    <div class="threat-hunting-content">
                        <div class="threat-hunting-grid" id="threatHuntingGrid">
                            <!-- Threat hunting cards will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Threat Response Automation -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <span>🚀</span>
                    <span>Threat Response Automation</span>
                </h2>
                <div class="section-status">
                    <div class="status-dot active"></div>
                    <span>Auto-Response Active</span>
                </div>
            </div>
            <div class="response-automation-grid" id="responseAutomationGrid">
                <!-- Response automation cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- ThreatScanner Activity Feed -->
        <div class="activity-feed">
            <div class="feed-header">
                <h2 class="feed-title">
                    <span>🛡️</span>
                    <span>ThreatScanner Activity Feed</span>
                </h2>
                <div class="live-indicator">
                    <div class="live-dot"></div>
                    <span>LIVE</span>
                </div>
            </div>
            <div class="feed-content" id="threatActivityFeed">
                <!-- Feed items will be populated by ActivityFeedManager -->
            </div>
        </div>
    </div>

    <!-- Agent Shutdown Modal -->
    <div class="modal-overlay" id="agentShutdownModal" onclick="closeModalOnOverlay(event)">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">⚠️ Agent Control Toggle</h2>
            </div>
            <div class="modal-content">
                Toggle autonomous mode? When paused, manual control remains available through the AI chat bot CLI. System will fallback to local control mode if external APIs are offline.
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-primary" onclick="confirmAgentShutdown()">Toggle Agent Mode</button>
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- AI Chat Widget -->
    <div class="ai-chat-widget">
        <div class="ai-chat-window" id="aiChatWindow">
            <div class="ai-chat-header">
                <div class="ai-chat-status">
                    <span class="chat-status-dot"></span>
                    <span>MAIN AGENT ONLINE</span>
                </div>
                <button class="ai-chat-close" onclick="toggleChat()">×</button>
            </div>
            <div class="cli-mode-indicator" id="cliModeIndicator">
                ⚠️ CLI MODE - Main Agent Offline
            </div>
            <div class="ai-chat-messages" id="aiChatMessages">
                <div class="ai-message">
                    <div class="ai-message-bubble">
                        ThreatScanner V4 online. Enhanced AI correlation engine active. Processing 147K events/sec with hybrid-resistant encryption. Coordinating with DefenseOrchestrator, AnalyticsEngine, and EncryptionManager for comprehensive threat intelligence.
                    </div>
                    <div class="ai-message-time">Just now</div>
                </div>
            </div>
            <div class="ai-chat-input-container">
                <input 
                    type="text" 
                    class="ai-chat-input" 
                    id="aiChatInput" 
                    placeholder="Command the Main Agent"
                    onkeypress="handleChatKeyPress(event)"
                >
                <button class="ai-chat-send" id="aiChatSend" onclick="sendChatMessage()">SEND</button>
            </div>
        </div>
        <button class="ai-chat-toggle" onclick="toggleChat()">🤖</button>
    </div>

    <script src="shared.js"></script>
    <script>
        // Threats page-specific configurations
        let threatAutoExecution = true;
        let autoThreatInterval;
        let automationExecutionInterval;
        let threatFeedId = 'threats-feed';

        // Enhanced V4 threat data - leveraging shared.js for sub-agent coordination
        const ThreatData = {
            activeThreats: [
                {
                    id: 1,
                    name: 'Advanced DDoS Attack',
                    type: 'Network Attack',
                    severity: 'critical',
                    source: '45.12.78.* (Botnet)',
                    target: 'API Gateway',
                    attempts: '67,892',
                    status: 'Mitigating',
                    aiAnalysis: 'Multi-vector attack pattern matches APT-29. Coordinating with DefenseOrchestrator for automated mitigation.',
                    subAgent: 'ThreatScanner → DefenseOrchestrator'
                },
                {
                    id: 2,
                    name: 'SQL Injection Campaign',
                    type: 'Web Application',
                    severity: 'critical',
                    source: '192.168.1.105',
                    target: '/api/users',
                    attempts: '247',
                    status: 'Blocked',
                    aiAnalysis: 'Union-based SQL injection with privilege escalation. EncryptionManager prevented data access.',
                    subAgent: 'ThreatScanner → EncryptionManager'
                },
                {
                    id: 3,
                    name: 'Insider Threat Pattern',
                    type: 'Behavioral Analysis',
                    severity: 'critical',
                    source: 'Internal User',
                    target: 'Sensitive Data',
                    attempts: '15',
                    status: 'Investigating',
                    aiAnalysis: 'Anomalous access patterns detected. AnalyticsEngine flagged behavioral deviation.',
                    subAgent: 'ThreatScanner → AnalyticsEngine'
                },
                {
                    id: 4,
                    name: 'Zero-Day Exploit Attempt',
                    type: 'Advanced Persistent Threat',
                    severity: 'high',
                    source: 'Unknown',
                    target: 'Web Server',
                    attempts: 'N/A',
                    status: 'Analyzing',
                    aiAnalysis: 'Novel attack vector identified. AI correlation engine updating threat signatures.',
                    subAgent: 'ThreatScanner → AI Engine'
                },
                {
                    id: 5,
                    name: 'Cryptocurrency Mining Malware',
                    type: 'Malware',
                    severity: 'high',
                    source: '192.168.1.87',
                    target: 'Workstation Network',
                    attempts: '1,247',
                    status: 'Quarantined',
                    aiAnalysis: 'Coinhive variant detected. NetworkMapper isolated affected endpoints.',
                    subAgent: 'ThreatScanner → NetworkMapper'
                },
                {
                    id: 6,
                    name: 'Phishing Campaign',
                    type: 'Social Engineering',
                    severity: 'high',
                    source: 'External Email',
                    target: 'User Credentials',
                    attempts: '4,892',
                    status: 'Blocked',
                    aiAnalysis: 'Targeted spear-phishing with credential harvesting. AnalyticsEngine updated patterns.',
                    subAgent: 'ThreatScanner → AnalyticsEngine'
                },
                {
                    id: 7,
                    name: 'VPN Anomaly Detection',
                    type: 'Network Communications',
                    severity: 'medium',
                    source: 'Multiple Locations',
                    target: 'VPN Endpoints',
                    attempts: '89',
                    status: 'Monitoring',
                    aiAnalysis: 'Geographic anomaly detected in VPN connections. VPNMonitor enhanced analysis active.',
                    subAgent: 'ThreatScanner → VPNMonitor'
                },
                {
                    id: 8,
                    name: 'Command & Control Traffic',
                    type: 'Network Communications',
                    severity: 'high',
                    source: 'c2.malicious-domain.net',
                    target: 'Multiple Endpoints',
                    attempts: '156',
                    status: 'Monitoring',
                    aiAnalysis: 'Persistent C2 beaconing detected. VPNMonitor and NetworkMapper coordinating response.',
                    subAgent: 'ThreatScanner → VPNMonitor'
                }
            ],
            threatAnalysis: [
                {
                    id: 'malware-family',
                    title: 'Malware Family Classification',
                    category: 'Ransomware',
                    indicators: '47 samples',
                    confidence: '98%',
                    description: 'Ryuk variants with novel evasion techniques detected',
                    severity: 'critical',
                    score: '9.4'
                },
                {
                    id: 'attack-vector',
                    title: 'Primary Attack Vector Analysis',
                    category: 'Email Phishing',
                    indicators: '2,847 emails',
                    confidence: '96%',
                    description: 'Spear-phishing campaign targeting finance departments',
                    severity: 'high',
                    score: '8.7'
                },
                {
                    id: 'persistence-method',
                    title: 'Persistence Method Detection',
                    category: 'Registry Keys',
                    indicators: '156 modifications',
                    confidence: '94%',
                    description: 'Advanced registry persistence mechanisms identified',
                    severity: 'high',
                    score: '8.2'
                },
                {
                    id: 'command-control',
                    title: 'Command & Control Pattern',
                    category: 'DNS Tunneling',
                    indicators: '23 domains',
                    confidence: '92%',
                    description: 'Covert DNS tunneling for data exfiltration detected',
                    severity: 'medium',
                    score: '7.8'
                },
                {
                    id: 'lateral-movement',
                    title: 'Lateral Movement Techniques',
                    category: 'WMI/PowerShell',
                    indicators: '89 instances',
                    confidence: '91%',
                    description: 'Living-off-the-land techniques for network traversal',
                    severity: 'medium',
                    score: '7.5'
                },
                {
                    id: 'data-exfiltration',
                    title: 'Data Exfiltration Methods',
                    category: 'HTTPS Tunneling',
                    indicators: '12 connections',
                    confidence: '89%',
                    description: 'Encrypted channels used for sensitive data theft',
                    severity: 'high',
                    score: '8.9'
                }
            ],
            threatIntelligence: [
                {
                    id: 'correlation-engine',
                    title: '🧠 AI Correlation Engine',
                    status: 'ACTIVE',
                    metrics: {
                        accuracy: '99.8%',
                        patterns: '2.4K',
                        speed: '0.3ms'
                    },
                    agents: ['AnalyticsEngine', 'AI Engine', 'DefenseOrchestrator']
                },
                {
                    id: 'behavioral-analysis',
                    title: '🎯 Behavioral Analysis',
                    status: 'LEARNING',
                    metrics: {
                        profiles: '247',
                        anomalies: '14',
                        confidence: '96%'
                    },
                    agents: ['AnalyticsEngine', 'NetworkMapper', 'LogAgent']
                },
                {
                    id: 'threat-prediction',
                    title: '🔮 Threat Prediction',
                    status: 'ACTIVE',
                    metrics: {
                        forecast: '72h',
                        models: '8',
                        accuracy: '94%'
                    },
                    agents: ['AI Engine', 'AnalyticsEngine', 'ThreatScanner']
                },
                {
                    id: 'signature-updates',
                    title: '🔄 Signature Updates',
                    status: 'SYNCING',
                    metrics: {
                        signatures: '45K',
                        updated: '2m ago',
                        sources: '12'
                    },
                    agents: ['ThreatScanner', 'DefenseOrchestrator', 'VPNMonitor']
                },
                {
                    id: 'threat-attribution',
                    title: '🔍 Threat Attribution',
                    status: 'ACTIVE',
                    metrics: {
                        actors: '127',
                        campaigns: '34',
                        confidence: '91%'
                    },
                    agents: ['ThreatScanner', 'AnalyticsEngine', 'AI Engine']
                },
                {
                    id: 'ioc-enrichment',
                    title: '📡 IOC Enrichment',
                    status: 'ACTIVE',
                    metrics: {
                        feeds: '23',
                        indicators: '890K',
                        quality: '98%'
                    },
                    agents: ['ThreatScanner', 'LogAgent', 'AnalyticsEngine']
                }
            ],
            threatHunting: [
                {
                    id: 'apt-campaign-hunt',
                    title: '🎯 APT Campaign Hunt',
                    priority: 'critical',
                    status: 'active',
                    progress: 78,
                    description: 'Investigating suspected APT-29 campaign targeting financial infrastructure with novel TTPs and custom malware variants',
                    iocs: [
                        'SHA256:a4b2c3d4...',
                        '45.12.78.92',
                        'evil.domain.com',
                        'MITRE:T1055'
                    ],
                    agents: ['ThreatScanner', 'AnalyticsEngine', 'AI Engine', 'LogAgent']
                },
                {
                    id: 'insider-behavior-hunt',
                    title: '👤 Insider Behavior Hunt',
                    priority: 'high',
                    status: 'investigating',
                    progress: 45,
                    description: 'Anomalous data access patterns from privileged accounts during off-hours, potential data theft investigation',
                    iocs: [
                        'user.jdoe@corp',
                        '192.168.1.105',
                        'lateral-move',
                        'MITRE:T1078'
                    ],
                    agents: ['ThreatScanner', 'AnalyticsEngine', 'NetworkMapper', 'LogAgent']
                },
                {
                    id: 'supply-chain-hunt',
                    title: '🔗 Supply Chain Hunt',
                    priority: 'high',
                    status: 'active',
                    progress: 23,
                    description: 'Investigating potential compromise of third-party software dependencies and update mechanisms in development environment',
                    iocs: [
                        'update-server.lib',
                        'MD5:9a8b7c6d...',
                        'signed-malware',
                        'MITRE:T1195'
                    ],
                    agents: ['ThreatScanner', 'AI Engine', 'EncryptionManager', 'ComplianceMonitor']
                },
                {
                    id: 'living-off-land-hunt',
                    title: '⚡ Living-off-Land Hunt',
                    priority: 'medium',
                    status: 'active',
                    progress: 67,
                    description: 'Tracking abuse of legitimate system tools for malicious purposes, including PowerShell and WMI exploitation patterns',
                    iocs: [
                        'powershell.exe',
                        'wmic.exe',
                        'base64-payload',
                        'MITRE:T1059'
                    ],
                    agents: ['ThreatScanner', 'AnalyticsEngine', 'LogAgent']
                }
            ],
            responseAutomation: [
                {
                    id: 'sql-injection-block',
                    title: '🛡️ SQL Injection Auto-Block',
                    status: 'active',
                    metrics: {
                        executions: '247',
                        success: '100%',
                        avgTime: '0.2s'
                    },
                    chain: 'ThreatScanner → EncryptionManager → DefenseOrchestrator',
                    description: 'Automatically blocks SQL injection attempts and protects data with encryption'
                },
                {
                    id: 'ddos-mitigation',
                    title: '⚡ DDoS Auto-Mitigation',
                    status: 'executing',
                    metrics: {
                        executions: '12',
                        success: '98%',
                        avgTime: '1.4s'
                    },
                    chain: 'ThreatScanner → DefenseOrchestrator → NetworkMapper',
                    description: 'Coordinates automated DDoS response across network infrastructure'
                },
                {
                    id: 'insider-threat-response',
                    title: '🎯 Insider Threat Response',
                    status: 'active',
                    metrics: {
                        executions: '8',
                        success: '94%',
                        avgTime: '3.1s'
                    },
                    chain: 'ThreatScanner → AnalyticsEngine → DefenseOrchestrator → LogAgent',
                    description: 'Behavioral analysis triggers automated access restriction and logging'
                },
                {
                    id: 'malware-quarantine',
                    title: '🔒 Malware Auto-Quarantine',
                    status: 'active',
                    metrics: {
                        executions: '156',
                        success: '99%',
                        avgTime: '0.8s'
                    },
                    chain: 'ThreatScanner → NetworkMapper → EncryptionManager',
                    description: 'Isolates infected endpoints and secures unaffected systems'
                },
                {
                    id: 'zero-day-analysis',
                    title: '🔍 Zero-Day Auto-Analysis',
                    status: 'standby',
                    metrics: {
                        executions: '3',
                        success: '100%',
                        avgTime: '12.5s'
                    },
                    chain: 'ThreatScanner → AI Engine → AnalyticsEngine → DefenseOrchestrator',
                    description: 'AI-powered analysis of novel threats with signature generation'
                },
                {
                    id: 'vpn-anomaly-response',
                    title: '🔒 VPN Anomaly Response',
                    status: 'active',
                    metrics: {
                        executions: '23',
                        success: '97%',
                        avgTime: '2.1s'
                    },
                    chain: 'ThreatScanner → VPNMonitor → DefenseOrchestrator',
                    description: 'Geographic and behavioral VPN anomaly detection with auto-response'
                }
            ]
        };

        // Threats page initialization using shared.js infrastructure
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initializeThreatsPage();
            }, 100);
        });

        function initializeThreatsPage() {
            // Initialize neural background first
            if (typeof initNeuralBackground === 'function') {
                initNeuralBackground();
            }

            // Initialize page context for shared.js
            if (typeof initializePageContext === 'function') {
                initializePageContext();
            }

            // Initialize enhanced module balance manager from shared.js
            if (typeof ModuleBalanceManager !== 'undefined') {
                ModuleBalanceManager.initializeBalancedModules();
            }

            // Initialize threats activity feed using shared.js ActivityFeedManager
            if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                // Initialize threats feed
                activityFeedManager.initializeFeed(threatFeedId, 'threats');
                activityFeedManager.setFeedContainer(threatFeedId, 'threatActivityFeed');
                
                // Add initial messages with staggered loading
                setTimeout(() => {
                    activityFeedManager.addMessage(threatFeedId, '🛡️ ThreatScanner V4 enhanced with AI correlation engine active', '', 'ThreatScanner');
                }, 800);
                
                setTimeout(() => {
                    activityFeedManager.addMessage(threatFeedId, '🔐 All threat data encrypted with hybrid-resistant algorithms', 'encryption', 'EncryptionManager');
                }, 1800);
                
                setTimeout(() => {
                    activityFeedManager.addMessage(threatFeedId, '🧠 AI correlation identified multi-stage attack campaign', '', 'AI Engine → ThreatScanner');
                }, 2800);
                
                setTimeout(() => {
                    activityFeedManager.addMessage(threatFeedId, '⚡ DefenseOrchestrator deployed honeypot targeting ransomware group', '', 'DefenseOrchestrator');
                }, 3800);
                
                // Start auto-generation after initial messages are loaded
                setTimeout(() => {
                    activityFeedManager.startAutoGeneration(threatFeedId, 7000);
                }, 5000);
            } else {
                console.log('ActivityFeedManager not available yet, retrying...');
                setTimeout(initializeThreatsPage, 200);
                return;
            }

            // Initialize chat system from shared.js
            if (typeof SentinelChat !== 'undefined') {
                window.sentinelChat = new SentinelChat();
            }

            // Populate all threat data sections
            populateActiveThreats();
            populateThreatAnalysis();
            populateThreatIntelligence();
            populateThreatHunting();
            populateResponseAutomation();
            
            // Start automated threat simulation
            startThreatSimulation();
            startAutomationSimulation();
            
            // Start periodic updates
            setInterval(() => {
                updateThreatMetrics();
            }, 4000);
            
            setInterval(() => {
                updateThreatAnalysis();
            }, 15000);
            
            setInterval(() => {
                updateHuntingProgress();
            }, 8000);
        }

        function populateActiveThreats() {
            const grid = document.getElementById('threatsGrid');
            if (!grid) return;
            
            grid.innerHTML = '';

            ThreatData.activeThreats.forEach(threat => {
                const card = document.createElement('div');
                card.className = `threat-card ${threat.severity}`;
                card.onclick = () => openThreatDetails(threat.id);
                
                card.innerHTML = `
                    <div class="threat-header">
                        <div>
                            <div class="threat-title">${threat.name}</div>
                            <div class="threat-type">${threat.type}</div>
                        </div>
                        <div class="threat-severity ${threat.severity}">${threat.severity.toUpperCase()}</div>
                    </div>
                    <div class="threat-details">
                        <div class="threat-detail">
                            <span class="threat-detail-label">Source</span>
                            <span class="threat-detail-value">${threat.source}</span>
                        </div>
                        <div class="threat-detail">
                            <span class="threat-detail-label">Target</span>
                            <span class="threat-detail-value">${threat.target}</span>
                        </div>
                        <div class="threat-detail">
                            <span class="threat-detail-label">Attempts</span>
                            <span class="threat-detail-value">${threat.attempts}</span>
                        </div>
                        <div class="threat-detail">
                            <span class="threat-detail-label">Status</span>
                            <span class="threat-detail-value" style="color: var(--primary);">${threat.status}</span>
                        </div>
                    </div>
                    <div class="threat-ai-status">
                        <div class="ai-analysis">${threat.aiAnalysis}</div>
                        <div class="sub-agent-coord">
                            <span>🤖</span>
                            <span>Coordination: ${threat.subAgent}</span>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function populateThreatAnalysis() {
            const list = document.getElementById('threatAnalysisList');
            if (!list) return;
            
            list.innerHTML = '';

            ThreatData.threatAnalysis.forEach(analysis => {
                const item = document.createElement('div');
                item.className = `threat-analysis-item ${analysis.severity}`;
                item.onclick = () => openThreatAnalysisDetails(analysis.id);
                
                item.innerHTML = `
                    <div class="threat-analysis-content-inner">
                        <div class="threat-analysis-title">${analysis.title}</div>
                        <div class="threat-analysis-details">
                            <div class="threat-analysis-label">Category</div>
                            <div class="threat-analysis-value">${analysis.category}</div>
                            <div class="threat-analysis-label">Indicators</div>
                            <div class="threat-analysis-value">${analysis.indicators}</div>
                            <div class="threat-analysis-description">${analysis.description} • Confidence: ${analysis.confidence}</div>
                        </div>
                    </div>
                    <div class="threat-analysis-score ${analysis.severity}">${analysis.score}</div>
                `;
                
                list.appendChild(item);
            });
        }

        function populateThreatIntelligence() {
            const grid = document.getElementById('intelligenceGrid');
            if (!grid) return;
            
            grid.innerHTML = '';

            ThreatData.threatIntelligence.forEach(intel => {
                const card = document.createElement('div');
                card.className = 'intelligence-card';
                card.onclick = () => openIntelligenceDetails(intel.id);
                
                card.innerHTML = `
                    <div class="intelligence-header">
                        <div class="intelligence-title">${intel.title}</div>
                        <div class="intelligence-status">${intel.status}</div>
                    </div>
                    <div class="intelligence-metrics">
                        ${Object.entries(intel.metrics).map(([key, value]) => `
                            <div class="intelligence-metric">
                                <div class="intelligence-metric-value">${value}</div>
                                <div class="intelligence-metric-label">${key}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="intelligence-coordination">
                        <div class="coordination-title">🤖 Sub-Agent Coordination</div>
                        <div class="coordination-agents">
                            ${intel.agents.map(agent => `
                                <span class="coordination-agent">${agent}</span>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function populateThreatHunting() {
            const grid = document.getElementById('threatHuntingGrid');
            if (!grid) return;
            
            grid.innerHTML = '';

            ThreatData.threatHunting.forEach(hunt => {
                const card = document.createElement('div');
                card.className = `threat-hunting-card ${hunt.status}`;
                card.onclick = () => openHuntDetails(hunt.id);
                
                card.innerHTML = `
                    <div class="hunting-header">
                        <div class="hunting-title">${hunt.title}</div>
                        <div class="hunting-priority ${hunt.priority}">${hunt.priority}</div>
                    </div>
                    <div class="hunting-description">${hunt.description}</div>
                    <div class="hunting-iocs">
                        <div class="hunting-iocs-title">🔍 Key IOCs</div>
                        <div class="hunting-iocs-list">
                            ${hunt.iocs.map(ioc => `<span class="hunting-ioc">${ioc}</span>`).join('')}
                        </div>
                    </div>
                    <div class="hunting-progress">
                        <div class="hunting-progress-header">
                            <span class="hunting-progress-label">Investigation Progress</span>
                            <span class="hunting-progress-percent">${hunt.progress}%</span>
                        </div>
                        <div class="hunting-progress-bar">
                            <div class="hunting-progress-fill" style="width: ${hunt.progress}%"></div>
                        </div>
                    </div>
                    <div class="hunting-agents">
                        <div class="hunting-agents-title">🤖 Coordinating Agents</div>
                        <div class="hunting-agents-list">
                            ${hunt.agents.map(agent => `<span class="hunting-agent">${agent}</span>`).join('')}
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function populateResponseAutomation() {
            const grid = document.getElementById('responseAutomationGrid');
            if (!grid) return;
            
            grid.innerHTML = '';

            ThreatData.responseAutomation.forEach(automation => {
                const card = document.createElement('div');
                card.className = `response-automation-card ${automation.status === 'executing' ? 'executing' : ''}`;
                card.onclick = () => openAutomationDetails(automation.id);
                
                card.innerHTML = `
                    <div class="automation-header">
                        <div class="automation-title">${automation.title}</div>
                        <div class="automation-status ${automation.status}">${automation.status}</div>
                    </div>
                    <div class="automation-metrics">
                        ${Object.entries(automation.metrics).map(([key, value]) => `
                            <div class="automation-metric">
                                <div class="automation-metric-value">${value}</div>
                                <div class="automation-metric-label">${key}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="automation-coordination">
                        <div class="automation-coordination-title">🤖 Automation Chain</div>
                        <div class="automation-chain">${automation.chain}</div>
                    </div>
                    <div class="automation-progress" id="progress-${automation.id}">
                        <div class="automation-progress-bar">
                            <div class="automation-progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="automation-progress-text">Executing Response...</div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Automation simulation using shared patterns
        function startThreatSimulation() {
            if (autoThreatInterval) clearInterval(autoThreatInterval);
            
            autoThreatInterval = setInterval(() => {
                if (threatAutoExecution && typeof SentinelState !== 'undefined' && SentinelState.agentActive) {
                    simulateThreatResponse();
                }
            }, 20000);
        }

        function startAutomationSimulation() {
            if (automationExecutionInterval) clearInterval(automationExecutionInterval);
            
            automationExecutionInterval = setInterval(() => {
                if (threatAutoExecution && typeof SentinelState !== 'undefined' && SentinelState.agentActive) {
                    simulateAutomationExecution();
                }
            }, 25000);
        }

        function simulateThreatResponse() {
            // Use ActivityFeedManager from shared.js instead of manual feed
            const responseActions = [
                'SQL injection blocked by AI correlation',
                'DDoS mitigation coordinated with DefenseOrchestrator',
                'Insider threat pattern flagged by AnalyticsEngine',
                'Zero-day signature updated via AI Engine',
                'Behavioral anomaly detected and contained',
                'Phishing campaign blocked automatically',
                'VPN anomaly investigation by VPNMonitor completed'
            ];
            
            const action = responseActions[Math.floor(Math.random() * responseActions.length)];
            if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                activityFeedManager.addMessage(threatFeedId, `🤖 Auto-executed: ${action}`, '', 'ThreatScanner');
            }
            
            if (typeof SentinelState !== 'undefined' && SentinelState.chatOpen && window.sentinelChat) {
                window.sentinelChat.addMessage(`ThreatScanner: Auto-executed "${action}" successfully. All sub-agent coordination maintained with hybrid encryption.`, false, 'system');
            }
        }

        function simulateAutomationExecution() {
            const activeAutomations = ThreatData.responseAutomation.filter(a => a.status === 'active');
            if (activeAutomations.length === 0) return;
            
            const automation = activeAutomations[Math.floor(Math.random() * activeAutomations.length)];
            executeAutomation(automation.id, automation.title);
        }

        function executeAutomation(automationId, title) {
            const cards = document.querySelectorAll('.response-automation-card');
            let card = null;
            let progressElement = null;
            
            cards.forEach(c => {
                const progress = c.querySelector(`#progress-${automationId}`);
                if (progress) {
                    card = c;
                    progressElement = progress;
                }
            });
            
            if (!card || !progressElement) return;
            
            // Mark as executing
            card.classList.add('executing');
            progressElement.classList.add('active');
            
            // Update status badge
            const statusBadge = card.querySelector('.automation-status');
            if (statusBadge) {
                statusBadge.textContent = 'EXECUTING';
                statusBadge.className = 'automation-status executing';
            }
            
            // Simulate realistic progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 20 + 10;
                const progressFill = progressElement.querySelector('.automation-progress-fill');
                
                if (progressFill) {
                    progressFill.style.width = Math.min(progress, 100) + '%';
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    completeAutomationExecution(automationId, title, card, progressElement, statusBadge);
                }
            }, 600);
        }

        function completeAutomationExecution(automationId, title, card, progressElement, statusBadge) {
            // Complete execution
            card.classList.remove('executing');
            progressElement.classList.remove('active');
            
            // Restore status
            if (statusBadge) {
                statusBadge.textContent = 'ACTIVE';
                statusBadge.className = 'automation-status active';
            }
            
            // Reset progress for next execution
            setTimeout(() => {
                const progressFill = progressElement.querySelector('.automation-progress-fill');
                if (progressFill) progressFill.style.width = '0%';
            }, 2000);
            
            // Update execution count
            const automation = ThreatData.responseAutomation.find(a => a.id === automationId);
            if (automation) {
                const currentCount = parseInt(automation.metrics.executions.replace(/[^\d]/g, ''));
                automation.metrics.executions = (currentCount + 1).toString();
                
                // Update display
                const executionMetric = card.querySelector('.automation-metric .automation-metric-value');
                if (executionMetric && executionMetric.textContent === automation.metrics.executions.replace(/\+1/, '')) {
                    executionMetric.textContent = automation.metrics.executions;
                }
            }
            
            // Add completion notification to feed using ActivityFeedManager
            if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                activityFeedManager.addMessage(threatFeedId, `✅ Auto-executed: ${title} completed successfully`, '', 'ThreatScanner');
            }
            
            // Notify chat if open
            if (typeof SentinelState !== 'undefined' && SentinelState.chatOpen && window.sentinelChat) {
                window.sentinelChat.addMessage(`🤖 ThreatScanner: Auto-executed "${title}" successfully. Sub-agent coordination maintained with hybrid encryption.`, false, 'system');
            }
        }

        // Update functions using shared patterns
        function updateThreatMetrics() {
            // Occasionally change threat count
            if (Math.random() > 0.9) {
                const threatEl = document.getElementById('activeThreats');
                if (threatEl) {
                    const current = parseInt(threatEl.textContent);
                    threatEl.textContent = Math.max(6, Math.min(10, current + Math.floor(Math.random() * 3 - 1)));
                }
            }
            
            // Update blocked count
            const blocked = document.getElementById('blockedToday');
            if (blocked && Math.random() > 0.85) {
                const current = parseInt(blocked.textContent.replace(',', ''));
                const newCount = current + Math.floor(Math.random() * 15 + 5);
                blocked.textContent = newCount.toLocaleString();
            }
            
            // Update correlation metrics
            if (Math.random() > 0.9) {
                const correlatedThreats = document.getElementById('correlatedThreats');
                if (correlatedThreats) {
                    const newCorrelated = Math.floor(Math.random() * 20 + 12);
                    correlatedThreats.textContent = newCorrelated;
                }
            }
        }

        function updateThreatAnalysis() {
            // Update threat analysis with new detections
            if (Math.random() > 0.8) {
                ThreatData.threatAnalysis.forEach((analysis, index) => {
                    if (Math.random() > 0.7) {
                        // Update indicators count
                        const currentCount = parseInt(analysis.indicators.split(' ')[0]);
                        const increment = Math.floor(Math.random() * 5 + 1);
                        const newCount = currentCount + increment;
                        analysis.indicators = newCount + ' ' + analysis.indicators.split(' ').slice(1).join(' ');
                        
                        // Slight confidence adjustment
                        const currentConf = parseInt(analysis.confidence);
                        const newConf = Math.min(99, Math.max(85, currentConf + Math.floor(Math.random() * 3 - 1)));
                        analysis.confidence = newConf + '%';
                        
                        // Update display
                        const item = document.querySelectorAll('.threat-analysis-item')[index];
                        if (item) {
                            const indicatorsElement = item.querySelectorAll('.threat-analysis-value')[1];
                            const descElement = item.querySelector('.threat-analysis-description');
                            if (indicatorsElement) indicatorsElement.textContent = analysis.indicators;
                            if (descElement) {
                                descElement.textContent = analysis.description + ' • Confidence: ' + analysis.confidence;
                            }
                        }
                    }
                });
            }
        }

        function updateHuntingProgress() {
            // Simulate hunting progress updates
            if (Math.random() > 0.7) {
                ThreatData.threatHunting.forEach((hunt, index) => {
                    if (hunt.status === 'active' && hunt.progress < 95) {
                        const increment = Math.floor(Math.random() * 5 + 1);
                        hunt.progress = Math.min(95, hunt.progress + increment);
                        
                        // Update progress bar
                        const card = document.querySelectorAll('.threat-hunting-card')[index];
                        if (card) {
                            const progressFill = card.querySelector('.hunting-progress-fill');
                            const progressPercent = card.querySelector('.hunting-progress-percent');
                            if (progressFill) progressFill.style.width = hunt.progress + '%';
                            if (progressPercent) progressPercent.textContent = hunt.progress + '%';
                        }
                        
                        // Add feed update using ActivityFeedManager
                        if (hunt.progress % 20 === 0 && typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                            activityFeedManager.addMessage(threatFeedId, `🔍 ${hunt.title}: Investigation ${hunt.progress}% complete`, '', 'ThreatScanner');
                        }
                    }
                });
            }
        }

        // Detail view functions - leveraging shared chat system
        function openThreatDetails(threatId) {
            if (window.sentinelChat && typeof SentinelState !== 'undefined' && !SentinelState.chatOpen) {
                window.sentinelChat.toggle();
            }
            setTimeout(() => {
                const threat = ThreatData.activeThreats.find(t => t.id === threatId);
                if (threat && window.sentinelChat) {
                    window.sentinelChat.addMessage(`ThreatScanner V4: ${threat.name} Analysis
• Type: ${threat.type}
• Severity: ${threat.severity.toUpperCase()}
• Source: ${threat.source}
• Target: ${threat.target}
• Attempts: ${threat.attempts}  
• Status: ${threat.status}
• AI Analysis: ${threat.aiAnalysis}
• Sub-Agent Coordination: ${threat.subAgent}
• All threat data protected with hybrid-resistant encryption
• Correlation Score: ${Math.floor(Math.random() * 20 + 80)}% match with known patterns
• Automated Response: ${threat.status === 'Blocked' || threat.status === 'Quarantined' ? 'Successfully executed' : 'In progress'}`, false);
                }
            }, 300);
        }

        function openThreatAnalysisDetails(analysisId) {
            if (window.sentinelChat && typeof SentinelState !== 'undefined' && !SentinelState.chatOpen) {
                window.sentinelChat.toggle();
            }
            setTimeout(() => {
                const analysis = ThreatData.threatAnalysis.find(a => a.id === analysisId);
                if (analysis && window.sentinelChat) {
                    window.sentinelChat.addMessage(`ThreatScanner Analysis: ${analysis.title}
• Category: ${analysis.category}
• Severity: ${analysis.severity.toUpperCase()} (Score: ${analysis.score}/10)
• Indicators: ${analysis.indicators}
• Confidence Level: ${analysis.confidence}
• Analysis: ${analysis.description}
• AI Classification: Advanced pattern recognition with MITRE ATT&CK mapping
• Data Protection: All analysis data encrypted with hybrid-resistant algorithms
• Integration: Real-time correlation with DefenseOrchestrator and AnalyticsEngine
• Automated Response: Signatures updated and countermeasures deployed`, false);
                }
            }, 300);
        }

        function openIntelligenceDetails(intelId) {
            if (window.sentinelChat && typeof SentinelState !== 'undefined' && !SentinelState.chatOpen) {
                window.sentinelChat.toggle();
            }
            setTimeout(() => {
                const intel = ThreatData.threatIntelligence.find(i => i.id === intelId);
                if (intel && window.sentinelChat) {
                    const metricsText = Object.entries(intel.metrics).map(([key, value]) => `${key}: ${value}`).join(', ');
                    window.sentinelChat.addMessage(`ThreatScanner Intelligence: ${intel.title}
• Status: ${intel.status}
• Metrics: ${metricsText}
• Coordinating Sub-Agents: ${intel.agents.join(', ')}
• AI Enhancement: Real-time pattern recognition and behavioral analysis
• Data Protection: All intelligence encrypted with hybrid-resistant algorithms
• Integration: Seamless coordination with DefenseOrchestrator, AnalyticsEngine, and AI Engine
• Performance: Processing 147K events/sec with 99.8% accuracy`, false);
                }
            }, 300);
        }

        function openHuntDetails(huntId) {
            if (window.sentinelChat && typeof SentinelState !== 'undefined' && !SentinelState.chatOpen) {
                window.sentinelChat.toggle();
            }
            setTimeout(() => {
                const hunt = ThreatData.threatHunting.find(h => h.id === huntId);
                if (hunt && window.sentinelChat) {
                    window.sentinelChat.addMessage(`ThreatScanner Hunt: ${hunt.title}
• Priority: ${hunt.priority.toUpperCase()}
• Status: ${hunt.status.toUpperCase()}
• Progress: ${hunt.progress}% complete
• Description: ${hunt.description}
• Key IOCs: ${hunt.iocs.join(', ')}
• Coordinating Agents: ${hunt.agents.join(', ')}
• Data Protection: All hunt data encrypted with hybrid-resistant algorithms
• MITRE ATT&CK: Mapped to framework for threat intelligence correlation
• Timeline: Estimated completion in ${Math.floor((100 - hunt.progress) / 10)} hours
• AI Enhancement: Pattern recognition and behavioral analysis active`, false);
                }
            }, 300);
        }

        function openAutomationDetails(automationId) {
            if (window.sentinelChat && typeof SentinelState !== 'undefined' && !SentinelState.chatOpen) {
                window.sentinelChat.toggle();
            }
            setTimeout(() => {
                const automation = ThreatData.responseAutomation.find(a => a.id === automationId);
                if (automation && window.sentinelChat) {
                    const metricsText = Object.entries(automation.metrics).map(([key, value]) => `${key}: ${value}`).join(', ');
                    window.sentinelChat.addMessage(`ThreatScanner Automation: ${automation.title}
• Status: ${automation.status.toUpperCase()}
• Metrics: ${metricsText}
• Automation Chain: ${automation.chain}
• Description: ${automation.description}
• Data Protection: All automation steps use hybrid-resistant encryption
• Response Speed: Sub-millisecond detection with coordinated response
• SOC Integration: Fully automated with manual override capability
• Compliance: All actions logged with Dilithium-3 signatures`, false);
                }
            }, 300);
        }

        function showMetricDetails(type) {
            if (window.sentinelChat && typeof SentinelState !== 'undefined' && !SentinelState.chatOpen) {
                window.sentinelChat.toggle();
            }
            setTimeout(() => {
                let message = '';
                switch(type) {
                    case 'threats':
                        message = 'ThreatScanner: 8 active threats currently under analysis and response. AI correlation engine coordinating with DefenseOrchestrator and AnalyticsEngine.';
                        break;
                    case 'blocked':
                        message = 'ThreatScanner: 3,247 threats blocked today through automated response chains. Success rate: 99.8% with sub-second response times.';
                        break;
                    case 'detection':
                        message = 'ThreatScanner: 99.8% detection rate maintained through AI correlation engine and behavioral analysis. Processing 147K events/sec.';
                        break;
                    case 'correlated':
                        message = 'ThreatScanner: 16 threats correlated with known attack patterns. MITRE ATT&CK framework integration active with threat attribution.';
                        break;
                }
                if (window.sentinelChat) {
                    window.sentinelChat.addMessage(message, false);
                }
            }, 300);
        }

        function showEncryptionStatus(type) {
            if (window.sentinelChat && typeof SentinelState !== 'undefined' && !SentinelState.chatOpen) {
                window.sentinelChat.toggle();
            }
            setTimeout(() => {
                if (window.sentinelChat) {
                    window.sentinelChat.addMessage(`EncryptionManager: Hybrid encryption status - Post-quantum algorithms (Kyber-1024, Dilithium-3) protecting all threat intelligence. ThreatScanner reports all data hybrid-resistant with coordination across all ${Object.keys(SubAgentConfigs || {}).length} sub-agents.`, false);
                }
            }, 300);
        }

        // Cleanup activity feed on page unload
        window.addEventListener('beforeunload', () => {
            if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                activityFeedManager.stopAutoGeneration(threatFeedId);
            }
            if (autoThreatInterval) clearInterval(autoThreatInterval);
            if (automationExecutionInterval) clearInterval(automationExecutionInterval);
        });

        // Global functions for compatibility - leveraging shared chat system
        window.toggleChat = () => {
            if (window.sentinelChat) {
                window.sentinelChat.toggle();
            }
        };
        
        window.sendChatMessage = () => {
            const input = document.getElementById('aiChatInput');
            if (input && input.value.trim() && window.sentinelChat) {
                window.sentinelChat.sendMessage(input.value.trim());
                input.value = '';
            }
        };
        
        window.handleChatKeyPress = (e) => {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        };
        
        window.showAgentShutdownModal = () => {
            const modal = document.getElementById('agentShutdownModal');
            if (modal) modal.style.display = 'flex';
        };
        
        window.closeModal = () => {
            const modal = document.getElementById('agentShutdownModal');
            if (modal) modal.style.display = 'none';
        };
        
        window.closeModalOnOverlay = (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        };
        
        window.confirmAgentShutdown = () => {
            if (typeof SentinelState !== 'undefined') {
                SentinelState.agentActive = !SentinelState.agentActive;
                
                // Update UI elements
                const agentStatus = document.querySelector('.agent-status');
                const agentTitle = document.querySelector('.agent-title');
                const agentStatusText = document.querySelector('.agent-status-text');
                
                if (SentinelState.agentActive) {
                    if (agentStatus) {
                        agentStatus.style.background = 'rgba(0, 255, 136, 0.1)';
                        agentStatus.style.borderColor = '#00ff88';
                    }
                    if (agentTitle) {
                        agentTitle.textContent = 'AI Agent Active';
                        agentTitle.style.color = 'var(--primary)';
                    }
                    if (agentStatusText) {
                        agentStatusText.textContent = 'Autonomous with Manual Override';
                    }
                    
                    // Restart threat simulation and activity feed
                    threatAutoExecution = true;
                    startThreatSimulation();
                    startAutomationSimulation();
                    if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                        activityFeedManager.startAutoGeneration(threatFeedId, 7000);
                        activityFeedManager.addMessage(threatFeedId, '🤖 Main Agent resumed: Threat auto-response enabled', '', 'Main Agent');
                    }
                } else {
                    if (agentStatus) {
                        agentStatus.style.background = 'rgba(255, 170, 0, 0.1)';
                        agentStatus.style.borderColor = '#ffaa00';
                    }
                    if (agentTitle) {
                        agentTitle.textContent = 'AI Agent Paused';
                        agentTitle.style.color = '#ffaa00';
                    }
                    if (agentStatusText) {
                        agentStatusText.textContent = 'Manual Control Only';
                    }
                    
                    // Stop threat simulation and activity feed
                    threatAutoExecution = false;
                    if (autoThreatInterval) clearInterval(autoThreatInterval);
                    if (automationExecutionInterval) clearInterval(automationExecutionInterval);
                    if (typeof activityFeedManager !== 'undefined' && activityFeedManager) {
                        activityFeedManager.stopAutoGeneration(threatFeedId);
                        activityFeedManager.addMessage(threatFeedId, '⚠️ Main Agent paused: Manual threat response only', 'warning', 'Main Agent');
                    }
                }
                
                closeModal();
                
                if (SentinelState.chatOpen && window.sentinelChat) {
                    const status = SentinelState.agentActive ? 'resumed autonomous operation with threat auto-response' : 'switched to manual control mode';
                    window.sentinelChat.addMessage(`⚠️ Main Agent has ${status}. ThreatScanner coordination ${SentinelState.agentActive ? 'active' : 'paused'}.`, false, 'system');
                }
            }
        };
        
        window.handleLogout = () => {
            if (confirm('Are you sure you want to logout? The AI agent will continue protecting against threats autonomously.')) {
                localStorage.removeItem('sentinel_auth');
                localStorage.removeItem('sentinel_scale');
                window.location.href = 'index.html';
            }
        };
    </script>
</body>
</html>
